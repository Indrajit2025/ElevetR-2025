{% extends 'base.html' %} {% block title %}{{ student.full_name }}'s Profile -
ElevatR{% endblock %} {% block head_extra %}
<style>
  body {
    background: linear-gradient(to right, #142543, #091230) !important;
  }
  #vanta-bg {
    display: none;
  }
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  @keyframes slideInLeft {
    from {
      opacity: 0;
      transform: translateX(-50px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(50px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  @keyframes pulseGlow {
    0%,
    100% {
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
    }
    50% {
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.8);
    }
  }
  @keyframes shimmer {
    0% {
      background-position: -1000px 0;
    }
    100% {
      background-position: 1000px 0;
    }
  }
  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
  .animate-spin {
    animation: spin 1s linear infinite;
  }
  .animate-fadeInUp {
    animation: fadeInUp 0.6s ease-out;
  }
  .animate-slideInLeft {
    animation: slideInLeft 0.8s ease-out;
  }
  .animate-slideInRight {
    animation: slideInRight 0.8s ease-out;
  }
  .profile-img-glow {
    animation: pulseGlow 3s ease-in-out infinite;
  }
  .progress-bar-shimmer::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.3),
      transparent
    );
    animation: shimmer 2s infinite;
  }
  .glass-card {
    background: rgba(0, 0, 0, 0.445);
    backdrop-filter: blur(20px);
    border: 3px solid rgb(0, 170, 255);
    border-radius: 1.5rem;
    padding: 1.5rem;
  }
  .skill-badge-hover {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .skill-badge-hover:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
  }
  .card-lift {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .card-lift:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 60px rgba(99, 102, 241, 0.3);
  }
  .material-icons {
    vertical-align: middle;
    line-height: inherit;
  }
  .fab {
    vertical-align: middle;
  }
  .improvement-plan {
    text-align: left;
    border-left: 3px solid #6366f1;
    padding-left: 1rem;
    margin-top: 1rem;
  }
  .improvement-plan ul {
    padding-left: 1.5rem;
    list-style-type: disc;
  }
  .improvement-plan li {
    margin-bottom: 0.5rem;
    color: #d1d5db;
  }

  .career-simulator ul {
    list-style: none; /* Removes default bullets */
    padding-left: 0;
  }
  .career-simulator ul li {
    margin-bottom: 1rem;
    position: relative;
    padding-left: 2rem;
    font-size: 0.9rem;
    line-height: 1.6;
  }
  .career-simulator ul li::before {
    content: "üöÄ";
    position: absolute;
    left: 0;
    top: 0.25rem;
    font-size: 1.25rem;
  }

  .book-loader {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 2rem;
  }

  .book,
  .book__pg-shadow,
  .book__pg {
    animation: cover 5s ease-in-out infinite;
  }
  .book {
    background-color: hsl(268, 90%, 65%);
    border-radius: 0.25em;
    box-shadow: 0 0.25em 0.5em hsla(0, 0%, 0%, 0.3),
      0 0 0 0.25em hsl(278, 100%, 57%) inset;
    padding: 0.25em;
    perspective: 37.5em;
    position: relative;
    width: 8em;
    height: 6em;
    transform: translate3d(0, 0, 0);
    transform-style: preserve-3d;
  }
  .book__pg-shadow,
  .book__pg {
    position: absolute;
    left: 0.25em;
    width: calc(50% - 0.25em);
  }
  .book__pg-shadow {
    animation-name: shadow;
    background-image: linear-gradient(
      -45deg,
      hsla(0, 0%, 0%, 0) 50%,
      hsla(0, 0%, 0%, 0.3) 50%
    );
    filter: blur(0.25em);
    top: calc(100% - 0.25em);
    height: 3.75em;
    transform: scaleY(0);
    transform-origin: 100% 0%;
  }
  .book__pg {
    animation-name: pg1;
    background-color: hsl(223, 10%, 100%);
    background-image: linear-gradient(
      90deg,
      hsla(223, 10%, 90%, 0) 87.5%,
      hsl(223, 10%, 90%)
    );
    height: calc(100% - 0.5em);
    transform-origin: 100% 50%;
  }
  .book__pg--2,
  .book__pg--3,
  .book__pg--4 {
    background-image: repeating-linear-gradient(
        hsl(223, 10%, 10%) 0 0.125em,
        hsla(223, 10%, 10%, 0) 0.125em 0.5em
      ),
      linear-gradient(90deg, hsla(223, 10%, 90%, 0) 87.5%, hsl(223, 10%, 90%));
    background-repeat: no-repeat;
    background-position: center;
    background-size: 2.5em 4.125em, 100% 100%;
  }
  .book__pg--2 {
    animation-name: pg2;
  }
  .book__pg--3 {
    animation-name: pg3;
  }
  .book__pg--4 {
    animation-name: pg4;
  }
  .book__pg--5 {
    animation-name: pg5;
  }

  @keyframes cover {
    from,
    5%,
    45%,
    55%,
    95%,
    to {
      animation-timing-function: ease-out;
      background-color: hsl(278, 84%, 67%);
    }
    10%,
    40%,
    60%,
    90% {
      animation-timing-function: ease-in;
      background-color: hsl(271, 90%, 45%);
    }
  }
  @keyframes shadow {
    from,
    10.01%,
    20.01%,
    30.01%,
    40.01% {
      animation-timing-function: ease-in;
      transform: translate3d(0, 0, 1px) scaleY(0) rotateY(0);
    }
    5%,
    15%,
    25%,
    35%,
    45%,
    55%,
    65%,
    75%,
    85%,
    95% {
      animation-timing-function: ease-out;
      transform: translate3d(0, 0, 1px) scaleY(0.2) rotateY(90deg);
    }
    10%,
    20%,
    30%,
    40%,
    50%,
    to {
      animation-timing-function: ease-out;
      transform: translate3d(0, 0, 1px) scaleY(0) rotateY(180deg);
    }
    50.01%,
    60.01%,
    70.01%,
    80.01%,
    90.01% {
      animation-timing-function: ease-in;
      transform: translate3d(0, 0, 1px) scaleY(0) rotateY(180deg);
    }
    60%,
    70%,
    80%,
    90%,
    to {
      animation-timing-function: ease-out;
      transform: translate3d(0, 0, 1px) scaleY(0) rotateY(0);
    }
  }
  @keyframes pg1 {
    from,
    to {
      animation-timing-function: ease-in-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(0.4deg);
    }
    10%,
    15% {
      animation-timing-function: ease-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(180deg);
    }
    20%,
    80% {
      animation-timing-function: ease-in;
      background-color: hsl(223, 10%, 45%);
      transform: translate3d(0, 0, 1px) rotateY(180deg);
    }
    85%,
    90% {
      animation-timing-function: ease-in-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(180deg);
    }
  }
  @keyframes pg2 {
    from,
    to {
      animation-timing-function: ease-in;
      background-color: hsl(223, 10%, 45%);
      transform: translate3d(0, 0, 1px) rotateY(0.3deg);
    }
    5%,
    10% {
      animation-timing-function: ease-in-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(0.3deg);
    }
    20%,
    25% {
      animation-timing-function: ease-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(179.9deg);
    }
    30%,
    70% {
      animation-timing-function: ease-in;
      background-color: hsl(223, 10%, 45%);
      transform: translate3d(0, 0, 1px) rotateY(179.9deg);
    }
    75%,
    80% {
      animation-timing-function: ease-in-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(179.9deg);
    }
    90%,
    95% {
      animation-timing-function: ease-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(0.3deg);
    }
  }
  @keyframes pg3 {
    from,
    10%,
    90%,
    to {
      animation-timing-function: ease-in;
      background-color: hsl(223, 10%, 45%);
      transform: translate3d(0, 0, 1px) rotateY(0.2deg);
    }
    15%,
    20% {
      animation-timing-function: ease-in-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(0.2deg);
    }
    30%,
    35% {
      animation-timing-function: ease-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(179.8deg);
    }
    40%,
    60% {
      animation-timing-function: ease-in;
      background-color: hsl(223, 10%, 45%);
      transform: translate3d(0, 0, 1px) rotateY(179.8deg);
    }
    65%,
    70% {
      animation-timing-function: ease-in-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(179.8deg);
    }
    80%,
    85% {
      animation-timing-function: ease-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(0.2deg);
    }
  }
  @keyframes pg4 {
    from,
    20%,
    80%,
    to {
      animation-timing-function: ease-in;
      background-color: hsl(223, 10%, 45%);
      transform: translate3d(0, 0, 1px) rotateY(0.1deg);
    }
    25%,
    30% {
      animation-timing-function: ease-in-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(0.1deg);
    }
    40%,
    45% {
      animation-timing-function: ease-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(179.7deg);
    }
    50% {
      animation-timing-function: ease-in;
      background-color: hsl(223, 10%, 45%);
      transform: translate3d(0, 0, 1px) rotateY(179.7deg);
    }
    55%,
    60% {
      animation-timing-function: ease-in-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(179.7deg);
    }
    70%,
    75% {
      animation-timing-function: ease-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(0.1deg);
    }
  }
  @keyframes pg5 {
    from,
    30%,
    70%,
    to {
      animation-timing-function: ease-in;
      background-color: hsl(223, 10%, 45%);
      transform: translate3d(0, 0, 1px) rotateY(0);
    }
    35%,
    40% {
      animation-timing-function: ease-in-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(0deg);
    }
    50% {
      animation-timing-function: ease-in-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(179.6deg);
    }
    60%,
    65% {
      animation-timing-function: ease-out;
      background-color: hsl(223, 10%, 100%);
      transform: translate3d(0, 0, 1px) rotateY(0);
    }
  }

  .loader-text {
    margin-top: 1rem;
    color: #a78bfa;
    font-size: 0.875rem;
    font-weight: 500;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %} {% block content %}
<div class="container mx-auto px-4 py-8 max-w-7xl">
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-1">
      <div
        class="glass-card text-center sticky top-28 animate-slideInLeft card-lift"
      >
        {% if student.profile_photo %}
        <img
          src="{{ url_for('static', filename='uploads/' + student.profile_photo) }}"
          class="w-40 h-40 rounded-full object-cover mx-auto mb-4 border-4 border-indigo-500 profile-img-glow"
          alt="Profile Photo"
        />
        {% else %}
        <img
          src="https://ui-avatars.com/api/?name={{ student.full_name | replace(' ', '+') }}&size=160&background=6366f1&color=fff&font-size=0.33"
          class="w-40 h-40 rounded-full object-cover mx-auto mb-4 border-4 border-indigo-500 profile-img-glow"
          alt="Default Photo"
        />
        {% endif %}

        <h2
          class="text-2xl font-bold bg-gradient-to-r from-white to-cyan-400 bg-clip-text text-transparent mb-2"
        >
          {{ student.full_name }}
        </h2>
        <p class="text-gray-400 mb-4">{{ student.college }}</p>

        <hr class="border-gray-700/30 my-4" />

        <div class="text-left space-y-3">
          <div class="flex items-center gap-2">
            <i class="material-icons text-indigo-400 text-xl">school</i>
            <span class="text-sm font-medium">CGPA:</span>
            <span
              class="ml-auto px-3 py-1 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full text-sm font-semibold"
            >
              {{ student.cgpa if student.cgpa else 'N/A' }}
            </span>
          </div>
          <div class="flex items-start gap-2">
            <i class="material-icons text-indigo-400 text-xl">email</i>
            <div class="flex-1">
              <span class="text-sm font-medium block">Email</span>
              <span class="text-gray-400 text-xs break-all"
                >{{ student.email }}</span
              >
            </div>
          </div>
          <div class="flex items-start gap-2">
            <i class="material-icons text-indigo-400 text-xl">phone</i>
            <div class="flex-1">
              <span class="text-sm font-medium block">Mobile</span>
              <span class="text-gray-400 text-xs">{{ student.mobile }}</span>
            </div>
          </div>
          <div class="pt-2">
            <div class="flex items-center gap-2 mb-3">
              <i class="material-icons text-indigo-400 text-xl">build</i>
              <span class="text-sm font-medium">Skills</span>
            </div>
            <div class="flex flex-wrap gap-2">
              {% if skills %} {% for skill in skills %}
              <span
                class="skill-badge-hover px-3 py-1 bg-gradient-to-r from-indigo-500/20 to-purple-500/20 border border-indigo-500/30 rounded-full text-xs font-medium hover:border-indigo-400 cursor-pointer"
              >
                {{ skill }}
              </span>
              {% endfor %} {% else %}
              <span class="text-gray-400 text-sm italic">No skills added.</span>
              {% endif %}
            </div>
          </div>
        </div>

        <a
          href="{{ url_for('student_edit_profile') }}"
          class="mt-6 w-full inline-flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-600 to-cyan-600 hover:from-indigo-700 hover:to-cyan-700 rounded-xl font-semibold transform hover:scale-105 transition-all duration-300 shadow-lg shadow-indigo-500/30"
        >
          <i class="material-icons text-lg">edit</i>
          Edit Profile
        </a>
        <a
          href="{{ url_for('download_resume') }}"
          class="mt-4 w-full inline-flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-600 hover:to-green-600 rounded-xl font-semibold transform hover:scale-105 transition-all duration-300 shadow-lg shadow-emerald-500/30"
        >
          <i class="material-icons text-lg">download</i>
          Download Resume (PDF)
        </a>
      </div>
    </div>

    <div class="lg:col-span-2 space-y-6">
      <div class="glass-card overflow-hidden animate-slideInRight card-lift">
        <div
          class="bg-gradient-to-r from-indigo-500/15 to-purple-500/15 border-b border-white/10 px-6 py-4"
        >
          <h3 class="text-xl font-bold flex items-center gap-2">
            <i class="material-icons text-yellow-400">star</i>
            Recommended Opportunities
          </h3>
        </div>
        <div class="p-6">
          {% if recommendations %}
          <div class="space-y-4">
            {% for rec in recommendations %}
            <div
              class="group bg-white/5 hover:bg-gradient-to-r hover:from-indigo-500/10 hover:to-purple-500/10 border border-white/10 hover:border-indigo-500 rounded-xl p-4 transition-all duration-300 hover:translate-x-2"
            >
              <div class="flex justify-between items-start mb-3">
                <div class="flex-1 pr-4">
                  <h4 class="font-semibold text-lg mb-1">
                    {{ rec.job.job_role }}
                  </h4>
                  <p class="text-white-400 text-sm mb-2">
                    {{ rec.job.company.company_name }} -
                    <span class="text-xs italic">{{ rec.job.location }}</span>
                  </p>
                  {% set required_skills_list = rec.job.required_skills |
                  fromjson %} {% if required_skills_list %}
                  <div
                    class="mt-2 flex flex-wrap gap-1.5"
                    title="Required Skills"
                  >
                    {% for skill in required_skills_list %}
                    <span
                      class="px-2 py-0.5 bg-gray-700/60 border border-gray-600/80 rounded-full text-xs font-medium text-gray-300"
                      >{{ skill }}</span
                    >
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
                {% set applied = False %} {% if student and student.applications
                %} {% for app in student.applications %} {% if app.job_id ==
                rec.job.id %} {% set applied = True %} {% endif %} {% endfor %}
                {% endif %} {% if applied %}
                <button
                  disabled
                  class="px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 rounded-lg text-sm font-semibold flex items-center gap-1 opacity-70 cursor-not-allowed whitespace-nowrap"
                >
                  <i class="material-icons text-sm">check_circle</i> Applied
                </button>
                {% else %}
                <a
                  href="{{ url_for('apply_job', job_id=rec.job.id) }}"
                  class="px-4 py-2 bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-700 hover:to-cyan-800 rounded-lg text-sm font-semibold transform hover:scale-105 transition-all duration-300 flex items-center gap-1 shadow-lg shadow-cyan-500/30 whitespace-nowrap"
                >
                  <i class="material-icons text-sm">send</i> Apply
                </a>
                {% endif %}
              </div>
              <div class="flex items-center gap-3">
                <span class="text-xs text-green-400 font-medium"
                  >Match Score:</span
                >
                <div
                  class="flex-1 max-w-xs h-3 bg-gray-700/50 rounded-full overflow-hidden relative"
                >
                  <div
                    class="progress-bar-shimmer h-full bg-gradient-to-r from-green-500 to-green-500 rounded-full relative"
                    style="width: {{rec.score}}%"
                  ></div>
                </div>
                <span class="text-sm font-semibold text-pink-100"
                  >{{ "%.1f"|format(rec.score) }}%</span
                >
              </div>

              {% if rec.roadmap and rec.roadmap|length > 0 %}
              <div class="mt-4 pt-3 border-t border-white/10">
                <h5
                  class="text-xs font-semibold text-yellow-400 mb-2 flex items-center gap-1"
                >
                  <i class="material-icons text-sm" style="font-size: 1.1em"
                    >model_training</i
                  >
                  AI-SUGGESTED ROADMAP:
                </h5>
                <div class="flex flex-wrap gap-2">
                  {% for item in rec.roadmap %}
                  <a
                    href="{{ item.link }}"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="skill-badge-hover px-3 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full text-xs font-medium text-yellow-300 hover:border-yellow-400 hover:text-white flex items-center gap-1 transition-all duration-300"
                  >
                    <i class="material-icons text-sm" style="font-size: 1em"
                      >play_circle_filled</i
                    >
                    <span>Learn {{ item.skill }}</span>
                  </a>
                  {% endfor %}
                </div>
              </div>
              {% endif %}

              <div class="mt-4 pt-3 border-t border-white/10">
                <h5
                  class="text-xs font-semibold text-cyan-400 mb-2 flex items-center gap-1"
                >
                  <i class="material-icons text-sm" style="font-size: 1.1em"
                    >map</i
                  >
                  CAREER ROADMAP:
                </h5>
                <button
                  type="button"
                  data-index="{{ loop.index0 }}"
                  data-job-role="{{ rec.job.job_role }}"
                  class="view-roadmap-btn px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 rounded-lg text-sm font-semibold transform hover:scale-105 transition-all duration-300 flex items-center gap-1 shadow-lg shadow-cyan-500/30"
                >
                  <i class="material-icons text-sm">explore</i>
                  <span>View Interactive Roadmap</span>
                </button>
                <div
                  id="roadmap-container-{{ loop.index0 }}"
                  class="mt-3"
                  style="display: none"
                ></div>
              </div>

              <div class="mt-4 pt-3 border-t border-white/10 text-right">
                <button
                  type="button"
                  data-index="{{ loop.index0 }}"
                  data-job-role="{{ rec.job.job_role }}"
                  data-company="{{ rec.job.company.company_name }}"
                  data-student-skills="{{ student.skills | tojson | escape }}"
                  data-job-skills="{{ rec.job.required_skills | escape }}"
                  class="generate-plan-btn px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-lg text-sm font-semibold transform hover:scale-105 transition-all duration-300 flex items-center gap-1 shadow-lg shadow-purple-500/30"
                >
                  <span>‚ú® Generate Improvement Plan</span>
                </button>
              </div>
              <div
                id="plan-placeholder-{{ loop.index0 }}"
                class="improvement-plan mt-3 p-3 bg-gray-800/50 border border-gray-700 rounded-lg text-sm text-gray-300"
                style="display: none"
              ></div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="text-center py-12">
            <i class="material-icons text-6xl text-gray-600 mb-4">inbox</i>
            <p class="text-gray-400">
              No recommendations available. Update your skills and projects in
              'Edit Profile' for better matches!
            </p>
          </div>
          {% endif %}
        </div>
      </div>

      <div
        class="glass-card overflow-hidden animate-slideInRight card-lift"
        style="animation-delay: 0.1s"
      >
        <div
          class="bg-gradient-to-r from-indigo-500/15 to-purple-500/15 border-b border-white/10 px-6 py-4"
        >
          <h3 class="text-xl font-bold flex items-center gap-2">
            <i class="material-icons text-emerald-400">trending_up</i>
            My Progress
          </h3>
        </div>
        <div class="p-6">
          <canvas id="progressChart" height="200"></canvas>
          <div
            id="progress-chart-loading"
            class="text-center py-12"
            style="display: none"
          >
            <i class="material-icons text-6xl text-gray-600 animate-spin"
              >sync</i
            >
            <p class="text-gray-400 mt-4">Loading progress data...</p>
          </div>
          <div
            id="progress-chart-empty"
            class="text-center py-12"
            style="display: none"
          >
            <i class="material-icons text-6xl text-gray-600"
              >signal_cellular_nodata</i
            >
            <p class="text-gray-400 mt-4">
              No progress data yet. <br />Edit your profile to log your first
              snapshot!
            </p>
          </div>
        </div>
      </div>
      <div
        class="glass-card overflow-hidden animate-slideInRight card-lift"
        style="animation-delay: 0.2s"
      >
        <div
          class="bg-gradient-to-r from-indigo-500/15 to-purple-500/15 border-b border-white/10 px-6 py-4"
        >
          <h3 class="text-xl font-bold flex items-center gap-2">
            <i class="material-icons text-indigo-400">code</i> My Projects
          </h3>
        </div>
        <div class="p-6">
          {% if projects %}
          <div class="space-y-4">
            {% for project in projects %}
            <div
              class="group bg-white/5 hover:bg-gradient-to-r hover:from-indigo-500/10 hover:to-purple-500/10 border border-white/10 hover:border-indigo-500 rounded-xl p-5 transition-all duration-300 hover:-translate-y-1"
            >
              <h4 class="font-semibold text-lg mb-2 flex items-center gap-2">
                <i class="material-icons text-indigo-400">folder_open</i> {{
                project.project_title }}
              </h4>
              <p class="text-gray-400 text-sm mb-4 leading-relaxed">
                {{ project.description }}
              </p>
              <div class="flex flex-wrap gap-2">
                {% if project.github_link %}
                <a
                  href="{{ project.github_link }}"
                  target="_blank"
                  class="px-4 py-2 bg-gradient-to-r from-gray-800 to-gray-900 hover:from-gray-700 hover:to-gray-800 rounded-lg text-sm font-semibold transform hover:scale-105 transition-all duration-300 flex items-center gap-1 shadow-lg"
                >
                  <i class="fab fa-github"></i> GitHub
                </a>
                {% endif %} {% if project.site_link %}
                <a
                  href="{{ project.site_link }}"
                  target="_blank"
                  class="px-4 py-2 bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-700 hover:to-cyan-800 rounded-lg text-sm font-semibold transform hover:scale-105 transition-all duration-300 flex items-center gap-1 shadow-lg shadow-cyan-500/30"
                >
                  <i class="material-icons text-sm">link</i> Live Site
                </a>
                {% endif %} {% if project.youtube_link %}
                <a
                  href="{{ project.youtube_link }}"
                  target="_blank"
                  class="px-4 py-2 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-lg text-sm font-semibold transform hover:scale-105 transition-all duration-300 flex items-center gap-1 shadow-lg shadow-red-500/30"
                >
                  <i class="fab fa-youtube"></i> YouTube
                </a>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="text-center py-12">
            <i class="material-icons text-6xl text-gray-600 mb-4">folder_off</i>
            <p class="text-gray-400">
              No projects added yet. Click 'Edit Profile' to showcase your work.
            </p>
          </div>
          {% endif %}
        </div>
      </div>

      <div
        class="glass-card overflow-hidden animate-slideInRight card-lift"
        style="animation-delay: 0.4s"
      >
        <div
          class="bg-gradient-to-r from-indigo-500/15 to-purple-500/15 border-b border-white/10 px-6 py-4"
        >
          <h3 class="text-xl font-bold flex items-center gap-2">
            <i class="material-icons text-green-400">workspace_premium</i> My
            Certificates
          </h3>
        </div>
        <div class="p-6">
          {% if certificates %}
          <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            {% for cert in certificates %}
            <div class="group">
              <a
                href="{{ url_for('static', filename='uploads/' + cert.filename) }}"
                target="_blank"
              >
                <img
                  src="{{ url_for('static', filename='uploads/' + cert.filename) }}"
                  alt="{{ cert.title }}"
                  class="rounded-lg object-cover w-full h-32 transition-transform duration-300 group-hover:scale-105"
                />
              </a>
              <p class="text-center text-sm mt-2 text-gray-300">
                {{ cert.title }}
              </p>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="text-center py-12">
            <i class="material-icons text-6xl text-gray-600 mb-4">school</i>
            <p class="text-gray-400">
              No certificates added yet. Click 'Edit Profile' to add your
              achievements.
            </p>
          </div>
          {% endif %}
        </div>
      </div>

      <a
        href="{{ url_for('all_internship_opportunity') }}"
        class="block w-full px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-xl text-center font-bold text-lg transform hover:scale-105 transition-all duration-300 shadow-lg shadow-green-500/30 flex items-center justify-center gap-2"
      >
        <i class="material-icons">work</i> Browse All Opportunities
      </a>
    </div>
  </div>
</div>
{% endblock %} {% block scripts_extra %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // --- NEW: Progress Chart Logic ---
    const ctx = document.getElementById("progressChart");
    const loadingDiv = document.getElementById("progress-chart-loading");
    const emptyDiv = document.getElementById("progress-chart-empty");
    let progressChartInstance = null;

    async function loadProgressChart() {
      if (!ctx) return;

      loadingDiv.style.display = "block";
      ctx.style.display = "none";
      emptyDiv.style.display = "none";

      try {
        const response = await fetch("{{ url_for('api_student_progress') }}");
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();

        if (!data.labels || data.labels.length === 0) {
          loadingDiv.style.display = "none";
          emptyDiv.style.display = "block";
          return;
        }

        loadingDiv.style.display = "none";
        ctx.style.display = "block";

        if (progressChartInstance) {
          progressChartInstance.destroy();
        }

        progressChartInstance = new Chart(ctx, {
          type: "line",
          data: {
            labels: data.labels,
            datasets: data.datasets.map((ds) => ({
              ...ds,
              tension: 0.3,
              borderWidth: 2,
              pointBackgroundColor: ds.borderColor,
              pointRadius: data.labels.length === 1 ? 5 : 2, // Larger point if only one data point
              pointHoverRadius: 6,
            })),
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  color: "#d1d5db", // text-gray-300
                  font: {
                    size: 12,
                  },
                },
              },
              tooltip: {
                mode: "index",
                intersect: false,
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                titleColor: "#ffffff",
                bodyColor: "#ffffff",
                borderColor: "rgba(255, 255, 255, 0.1)",
                borderWidth: 1,
              },
            },
            scales: {
              x: {
                grid: {
                  color: "rgba(255, 255, 255, 0.1)",
                },
                ticks: {
                  color: "#9ca3af", // text-gray-400
                },
              },
              y: {
                // Y-axis for CGPA (0-10 scale)
                type: "linear",
                position: "left",
                min: 0,
                max: 10,
                grid: {
                  color: "rgba(52, 211, 153, 0.2)", // emerald-400 transparent
                },
                ticks: {
                  color: "#34d399", // text-emerald-400
                },
                title: {
                  display: true,
                  text: "CGPA",
                  color: "#34d399",
                },
              },
              y1: {
                // Y-axis for counts (skills, projects, etc.)
                type: "linear",
                position: "right",
                min: 0,
                grid: {
                  drawOnChartArea: false, // only show grid for y-axis
                },
                ticks: {
                  color: "#9ca3af", // text-gray-400
                },
                title: {
                  display: true,
                  text: "Counts (Skills, Projects, etc.)",
                  color: "#9ca3af",
                },
              },
            },
            interaction: {
              mode: "index",
              intersect: false,
            },
          },
        });
      } catch (error) {
        console.error("Error loading progress chart:", error);
        loadingDiv.style.display = "none";
        emptyDiv.innerHTML = `<i class="material-icons text-6xl text-red-500">error_outline</i><p class="text-red-400 mt-4">Could not load chart data.</p>`;
        emptyDiv.style.display = "block";
      }
    }

    loadProgressChart();

    // --- End: Progress Chart Logic ---

    // Progress bar animation
    const progressBars = document.querySelectorAll(".progress-bar-shimmer");
    progressBars.forEach((bar) => {
      const width = bar.style.width;
      if (width && width !== "0") {
        bar.style.width = "0";
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            bar.style.transition = "width 1s ease-out";
            bar.style.width = width;
          });
        });
      }
    });

    // UPDATED: JavaScript for "Generate Improvement Plan" button - Using server-side API
    const generateButtons = document.querySelectorAll(".generate-plan-btn");

    generateButtons.forEach((button) => {
      button.addEventListener("click", async function () {
        console.log("Button clicked!");

        const index = this.dataset.index;
        const jobRole = this.dataset.jobRole;
        const company = this.dataset.company;
        const studentSkillsJson = this.dataset.studentSkills;
        const jobSkillsJson = this.dataset.jobSkills;

        console.log("Index:", index);
        console.log("Job Role:", jobRole);
        console.log("Company:", company);

        // Disable button and show loading state
        this.disabled = true;
        this.innerHTML =
          '<i class="material-icons text-sm animate-spin">sync</i> <span>Generating...</span>';

        const placeholderDiv = document.getElementById(
          `plan-placeholder-${index}`
        );
        placeholderDiv.style.display = "block";

        // Show book loading animation
        placeholderDiv.innerHTML = `
        <div class="book-loader">
          <div class="book">
            <div class="book__pg-shadow"></div>
            <div class="book__pg"></div>
            <div class="book__pg book__pg--2"></div>
            <div class="book__pg book__pg--3"></div>
            <div class="book__pg book__pg--4"></div>
            <div class="book__pg book__pg--5"></div>
          </div>
          <p class="loader-text">Generating personalized improvement plan...</p>
        </div>
      `;

        try {
          // Parse skills
          let studentSkills = [];
          let jobSkills = [];

          try {
            studentSkills = JSON.parse(studentSkillsJson || "[]");
            if (!Array.isArray(studentSkills)) studentSkills = [];
          } catch (e) {
            console.error("Error parsing student skills:", e);
          }

          try {
            jobSkills = JSON.parse(jobSkillsJson || "[]");
            if (!Array.isArray(jobSkills)) jobSkills = [];
          } catch (e) {
            console.error("Error parsing job skills:", e);
          }

          console.log("Student Skills:", studentSkills);
          console.log("Job Skills:", jobSkills);

          // Call server-side API endpoint instead of direct Gemini API
          const response = await fetch('/api/generate_improvement_plan', {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              jobRole: jobRole,
              company: company,
              studentSkills: studentSkills,
              jobSkills: jobSkills
            }),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || `API Error: ${response.status}`);
          }

          const data = await response.json();
          console.log("API Response:", data);

          if (!data.success) {
            throw new Error(data.error || "Failed to generate plan");
          }

          // Format response
          let formattedText = data.plan
            .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
            .replace(/^\* (.+)$/gm, "<li>$1</li>")
            .replace(/^(\d+)\. (.+)$/gm, "<li>$2</li>")
            .replace(/\n\n/g, "</p><p>")
            .replace(/\n/g, "<br>");

          if (formattedText.includes("<li>")) {
            formattedText = formattedText.replace(
              /(<li>.*<\/li>)/s,
              "<ul>$1</ul>"
            );
          }

          placeholderDiv.innerHTML = `<div class="text-gray-200">${formattedText}</div>`;
          this.innerHTML = "<span>‚úÖ Plan Generated!</span>";
        } catch (error) {
          console.error("Error:", error);
          placeholderDiv.innerHTML = `<p class="text-red-400">‚ö†Ô∏è Error generating plan: ${error.message}</p>`;
          this.disabled = false;
          this.innerHTML = "<span>‚ú® Generate Improvement Plan</span>";
        }
      });
    });

    console.log("Generate Plan buttons initialized:", generateButtons.length);
    // === END JAVASCRIPT CHANGE ===

    // Roadmap.sh Integration
    const roadmapMapping = {
      // Frontend roles
      "frontend developer": "frontend",
      "frontend engineer": "frontend",
      "react developer": "react",
      "angular developer": "angular",
      "vue developer": "vue",

      // Backend roles
      "backend developer": "backend",
      "backend engineer": "backend",
      "node.js developer": "nodejs",
      "java developer": "java",
      "python developer": "python",
      "golang developer": "golang",
      "spring boot developer": "spring-boot",

      // Full Stack
      "full stack developer": "full-stack",
      "fullstack developer": "full-stack",

      // Mobile
      "android developer": "android",
      "ios developer": "ios",
      "flutter developer": "flutter",
      "react native developer": "react-native",

      // DevOps & Cloud
      "devops engineer": "devops",
      "cloud engineer": "aws",
      "aws developer": "aws",
      "docker engineer": "docker",
      "kubernetes engineer": "kubernetes",

      // Data & AI
      "data scientist": "data-analyst",
      "data analyst": "data-analyst",
      "machine learning engineer": "mlops",
      "ai engineer": "ai-data-scientist",
      "data engineer": "data-analyst",

      // Other roles
      "qa engineer": "qa",
      "software architect": "software-architect",
      "system design": "system-design",
      "database administrator": "postgresql-dba",
      cybersecurity: "cyber-security",
      "ui/ux designer": "ux-design",
      "product manager": "product-manager",
      "blockchain developer": "blockchain",
    };

    function getRoadmapUrl(jobRole) {
      const roleLower = jobRole.toLowerCase().trim();

      // Direct match
      if (roadmapMapping[roleLower]) {
        return `https://roadmap.sh/${roadmapMapping[roleLower]}`;
      }

      // Partial match
      for (const [key, value] of Object.entries(roadmapMapping)) {
        if (roleLower.includes(key) || key.includes(roleLower)) {
          return `https://roadmap.sh/${value}`;
        }
      }

      // Check for specific keywords
      if (roleLower.includes("front")) return "https://roadmap.sh/frontend";
      if (roleLower.includes("back")) return "https://roadmap.sh/backend";
      if (roleLower.includes("full")) return "https://roadmap.sh/full-stack";
      if (roleLower.includes("devops")) return "https://roadmap.sh/devops";
      if (roleLower.includes("data")) return "https://roadmap.sh/data-analyst";
      if (roleLower.includes("mobile") || roleLower.includes("app"))
        return "https://roadmap.sh/android";
      if (roleLower.includes("qa") || roleLower.includes("test"))
        return "https://roadmap.sh/qa";
      if (roleLower.includes("security"))
        return "https://roadmap.sh/cyber-security";

      // Default fallback
      return "https://roadmap.sh";
    }

    // Add click event listeners to roadmap buttons
    const roadmapButtons = document.querySelectorAll(".view-roadmap-btn");

    roadmapButtons.forEach((button) => {
      button.addEventListener("click", function () {
        const index = this.dataset.index;
        const jobRole = this.dataset.jobRole;
        const container = document.getElementById(`roadmap-container-${index}`);

        if (container.style.display === "none") {
          const roadmapUrl = getRoadmapUrl(jobRole);

          container.innerHTML = `
          <div class="bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-500/30 rounded-lg p-4">
            <div class="flex items-start gap-3 mb-3">
              <i class="material-icons text-cyan-400 text-2xl">map</i>
              <div class="flex-1">
                <h6 class="font-semibold text-white mb-1">Interactive Career Roadmap</h6>
                <p class="text-gray-400 text-xs mb-3">
                  Follow this comprehensive roadmap to master the skills needed for <strong>${jobRole}</strong>. 
                  This interactive guide shows you exactly what to learn and in what order.
                </p>
              </div>
            </div>
            <div class="flex flex-wrap gap-2">
              <a href="${roadmapUrl}" target="_blank" rel="noopener noreferrer" 
                 class="px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 rounded-lg text-sm font-semibold transform hover:scale-105 transition-all duration-300 flex items-center gap-2 shadow-lg shadow-cyan-500/30">
                <i class="material-icons text-sm">open_in_new</i>
                <span>Open Full Roadmap</span>
              </a>
              <a href="https://roadmap.sh" target="_blank" rel="noopener noreferrer" 
                 class="px-4 py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 rounded-lg text-sm font-semibold transform hover:scale-105 transition-all duration-300 flex items-center gap-2">
                <i class="material-icons text-sm">explore</i>
                <span>Browse All Roadmaps</span>
              </a>
            </div>
            <div class="mt-3 p-3 bg-black/30 rounded-lg border border-cyan-500/20">
              <p class="text-xs text-gray-400 flex items-center gap-2">
                <i class="material-icons text-sm text-cyan-400">info</i>
                <span>Tip: Roadmap.sh provides step-by-step guides, resources, and tracks your progress as you learn!</span>
              </p>
            </div>
          </div>
        `;
          container.style.display = "block";
          this.innerHTML =
            '<i class="material-icons text-sm">expand_less</i><span>Hide Roadmap</span>';
        } else {
          container.style.display = "none";
          this.innerHTML =
            '<i class="material-icons text-sm">explore</i><span>View Interactive Roadmap</span>';
        }
      });
    });

    console.log("Roadmap buttons initialized:", roadmapButtons.length);
  });
</script>
{% endblock %}
