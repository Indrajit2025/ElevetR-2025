{% extends "base.html" %}

{% block title %}Tech Feed & Career Updates - ElevatR{% endblock %}

{% block head_extra %}
<style>
    .tech-feed-container {
        background: linear-gradient(180deg, #0a1628 0%, #0d1b2a 100%);
        min-height: 100vh;
        padding: 2rem 0;
    }

    @keyframes fadeIn {
        from { 
            opacity: 0; 
            transform: translateY(20px); 
        }
        to { 
            opacity: 1; 
            transform: translateY(0); 
        }
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .fade-in {
        animation: fadeIn 0.5s ease-out forwards;
    }

    .card-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: rgba(15, 27, 54, 0.6);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(108, 169, 255, 0.1);
    }

    .card-hover:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(108, 169, 255, 0.15);
        border-color: rgba(108, 169, 255, 0.3);
        background: rgba(15, 27, 54, 0.8);
    }

    .category-badge {
        transition: all 0.2s ease;
        cursor: default;
    }

    .category-badge:hover {
        transform: scale(1.05);
    }

    .category-tab {
        transition: all 0.3s ease;
        cursor: pointer;
        background: rgba(15, 27, 54, 0.6);
        border: 1px solid rgba(108, 169, 255, 0.2);
    }

    .category-tab:hover {
        transform: translateY(-2px);
        border-color: rgba(108, 169, 255, 0.4);
    }

    .category-tab.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        border-color: transparent;
    }

    .search-input {
        transition: all 0.3s ease;
        background: rgba(15, 27, 54, 0.6);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(108, 169, 255, 0.2);
        color: #f9fafc;
    }

    .search-input:focus {
        transform: scale(1.02);
        border-color: rgba(108, 169, 255, 0.5);
        background: rgba(15, 27, 54, 0.8);
    }

    .search-input::placeholder {
        color: rgba(249, 250, 252, 0.4);
    }

    .empty-state {
        animation: fadeIn 0.6s ease-out;
    }

    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .spinner {
        border: 3px solid rgba(108, 169, 255, 0.2);
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }

    .stat-card {
        background: rgba(15, 27, 54, 0.6);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(108, 169, 255, 0.2);
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        border-color: rgba(108, 169, 255, 0.4);
        transform: translateY(-4px);
    }

    .filter-select {
        background: rgba(15, 27, 54, 0.6);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(108, 169, 255, 0.2);
        color: #f9fafc;
        transition: all 0.3s ease;
    }

    .filter-select:focus {
        border-color: rgba(108, 169, 255, 0.5);
        background: rgba(15, 27, 54, 0.8);
    }

    .filter-select option {
        background: #0d1b2a;
        color: #f9fafc;
    }

    .refresh-btn {
        background: rgba(15, 27, 54, 0.6);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(108, 169, 255, 0.2);
        color: #f9fafc;
        transition: all 0.3s ease;
    }

    .refresh-btn:hover {
        border-color: rgba(108, 169, 255, 0.5);
        background: rgba(15, 27, 54, 0.8);
    }

    .page-header {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(108, 169, 255, 0.2);
        border-radius: 1.5rem;
        padding: 2rem;
        margin-bottom: 2rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="tech-feed-container">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Page Header -->
        <div class="page-header fade-in">
            <h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-2 bg-gradient-to-r from-indigo-400 to-cyan-400 bg-clip-text text-transparent">
                üì∞ Tech Feed & Career Updates
            </h1>
            <p class="text-gray-400 text-base md:text-lg">
                Stay updated with the latest in tech news, jobs, and opportunities
            </p>
        </div>

        <!-- Stats Bar -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 fade-in">
            <div class="stat-card p-4 rounded-xl text-center">
                <div class="text-3xl font-bold text-blue-400" id="stat-tech">0</div>
                <div class="text-sm text-gray-400">Tech News</div>
            </div>
            <div class="stat-card p-4 rounded-xl text-center">
                <div class="text-3xl font-bold text-green-400" id="stat-jobs">0</div>
                <div class="text-sm text-gray-400">Jobs</div>
            </div>
            <div class="stat-card p-4 rounded-xl text-center">
                <div class="text-3xl font-bold text-purple-400" id="stat-internships">0</div>
                <div class="text-sm text-gray-400">Internships</div>
            </div>
            <div class="stat-card p-4 rounded-xl text-center">
                <div class="text-3xl font-bold text-orange-400" id="stat-events">0</div>
                <div class="text-sm text-gray-400">Events</div>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="mb-8 space-y-4 fade-in">
            <!-- Search Bar -->
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
                <input
                    type="text"
                    id="searchInput"
                    placeholder="Search news, jobs, internships, events..."
                    onkeyup="filterItems()"
                    class="search-input w-full pl-12 pr-6 py-4 rounded-2xl text-base focus:outline-none"
                />
            </div>

            <!-- Filter Controls -->
            <div class="flex flex-wrap items-center gap-3">
                <span class="text-gray-300 font-medium flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                    </svg>
                    Filter:
                </span>
                <select 
                    id="categoryFilter" 
                    onchange="filterItems()"
                    class="filter-select px-6 py-3 rounded-xl font-medium cursor-pointer focus:outline-none"
                >
                    <option value="all">All Updates</option>
                    <option value="tech">Tech News</option>
                    <option value="jobs">Job Opportunities</option>
                    <option value="internships">Internships</option>
                    <option value="events">Events</option>
                </select>

                <button 
                    onclick="refreshNews()"
                    class="refresh-btn px-6 py-3 rounded-xl font-medium flex items-center gap-2"
                >
                    <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Refresh
                </button>
            </div>
        </div>

        <!-- Category Tabs -->
        <div class="flex flex-wrap gap-3 mb-8 fade-in" id="categoryTabs">
            <button 
                onclick="selectCategory('all')" 
                class="category-tab active px-6 py-3 rounded-xl font-semibold text-gray-300" 
                data-category="all"
            >
                All Updates
                <span class="ml-2 px-2 py-1 bg-purple-900/50 text-purple-300 rounded-full text-sm font-bold" id="count-all">0</span>
            </button>
            <button 
                onclick="selectCategory('tech')" 
                class="category-tab px-6 py-3 rounded-xl font-semibold text-gray-300" 
                data-category="tech"
            >
                üì± Tech News
                <span class="ml-2 px-2 py-1 bg-blue-900/50 text-blue-300 rounded-full text-sm font-bold" id="count-tech">0</span>
            </button>
            <button 
                onclick="selectCategory('jobs')" 
                class="category-tab px-6 py-3 rounded-xl font-semibold text-gray-300" 
                data-category="jobs"
            >
                üíº Jobs
                <span class="ml-2 px-2 py-1 bg-green-900/50 text-green-300 rounded-full text-sm font-bold" id="count-jobs">0</span>
            </button>
            <button 
                onclick="selectCategory('internships')" 
                class="category-tab px-6 py-3 rounded-xl font-semibold text-gray-300" 
                data-category="internships"
            >
                üéì Internships
                <span class="ml-2 px-2 py-1 bg-purple-900/50 text-purple-300 rounded-full text-sm font-bold" id="count-internships">0</span>
            </button>
            <button 
                onclick="selectCategory('events')" 
                class="category-tab px-6 py-3 rounded-xl font-semibold text-gray-300" 
                data-category="events"
            >
                üé™ Events
                <span class="ml-2 px-2 py-1 bg-orange-900/50 text-orange-300 rounded-full text-sm font-bold" id="count-events">0</span>
            </button>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="flex flex-col items-center justify-center py-16">
            <div class="spinner mb-4"></div>
            <p class="text-gray-400 font-medium">Loading latest tech news...</p>
        </div>

        <!-- News Grid -->
        <div id="newsGrid" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <!-- News items will be inserted here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-16 empty-state">
            <div class="text-7xl mb-4">üîç</div>
            <h3 class="text-2xl font-bold mb-2 text-gray-200">No items found</h3>
            <p class="text-gray-400">Try adjusting your search terms or filters.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts_extra %}
<script>
    let newsItems = [];
    let currentCategory = 'all';

    // Initialize app with immediate fallback data
    async function init() {
        // Load fallback data immediately (no waiting)
        addFallbackData();
        addSampleData();
        newsItems.sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate));
        updateCategoryCounts();
        updateStats();
        renderNewsItems();
        showLoading(false);

        // Then try to fetch real news in background (non-blocking)
        fetchNewsInBackground();
    }

    // Fetch news in background without blocking UI
    async function fetchNewsInBackground() {
        try {
            const response = await fetch('/api/fetch_tech-news');
            
            if (response.ok) {
                const data = await response.json();
                if (data.success && data.articles.length > 0) {
                    // Remove old tech news
                    newsItems = newsItems.filter(item => item.category !== 'tech');
                    // Add fresh tech news
                    newsItems.push(...data.articles);
                    // Keep jobs, internships, events
                    addSampleData();
                    
                    newsItems.sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate));
                    updateCategoryCounts();
                    updateStats();
                    renderNewsItems();
                }
            }
        } catch (error) {
            console.log('Using curated content');
        }
    }

    // Fetch news (for refresh button)
    async function fetchNews() {
        showLoading(true);
        
        // Show fallback immediately
        newsItems = [];
        addFallbackData();
        addSampleData();
        newsItems.sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate));
        updateCategoryCounts();
        updateStats();
        renderNewsItems();
        showLoading(false);

        // Try to get fresh data
        fetchNewsInBackground();
    }

    // Add sample jobs, internships, and events data
    function addSampleData() {
        // Remove duplicates first
        const existingIds = new Set(newsItems.map(item => item.id));
        
        const sampleData = [
            {
                id: 'job-1',
                title: 'Google Software Engineer - Machine Learning',
                summary: 'Join Google\'s AI team to build cutting-edge machine learning systems that impact billions of users worldwide.',
                url: 'https://careers.google.com',
                publishDate: new Date().toISOString(),
                category: 'jobs',
                source: 'Google Careers'
            },
            {
                id: 'job-2',
                title: 'Meta Frontend Developer - React',
                summary: 'Build the future of social technology with React and modern frontend frameworks at Meta.',
                url: 'https://metacareers.com',
                publishDate: new Date().toISOString(),
                category: 'jobs',
                source: 'Meta Careers'
            },
            {
                id: 'job-3',
                title: 'Amazon Cloud Solutions Architect',
                summary: 'Design and implement scalable cloud solutions using AWS services for enterprise clients.',
                url: 'https://amazon.jobs',
                publishDate: new Date().toISOString(),
                category: 'jobs',
                source: 'Amazon Jobs'
            },
            {
                id: 'intern-1',
                title: 'Microsoft Software Engineering Internship - Summer 2026',
                summary: 'Gain hands-on experience with Azure, AI, and cloud computing in a 12-week paid internship program.',
                url: 'https://careers.microsoft.com',
                publishDate: new Date().toISOString(),
                category: 'internships',
                source: 'Microsoft Careers'
            },
            {
                id: 'intern-2',
                title: 'Apple ML/AI Research Internship',
                summary: 'Work alongside world-class researchers on cutting-edge AI and machine learning projects.',
                url: 'https://jobs.apple.com',
                publishDate: new Date().toISOString(),
                category: 'internships',
                source: 'Apple Jobs'
            },
            {
                id: 'intern-3',
                title: 'Tesla Autonomous Driving Internship',
                summary: 'Contribute to the future of transportation with hands-on work in self-driving technology.',
                url: 'https://tesla.com/careers',
                publishDate: new Date().toISOString(),
                category: 'internships',
                source: 'Tesla Careers'
            },
            {
                id: 'event-1',
                title: 'Google I/O 2026 Developer Conference',
                summary: 'Annual developer conference featuring the latest in Android, AI, and Google technologies.',
                url: 'https://events.google.com/io',
                publishDate: new Date().toISOString(),
                category: 'events',
                source: 'Google Events'
            },
            {
                id: 'event-2',
                title: 'TechCrunch Disrupt 2025',
                summary: 'The world\'s leading startup event featuring pitch competitions, workshops, and networking.',
                url: 'https://techcrunch.com/events',
                publishDate: new Date().toISOString(),
                category: 'events',
                source: 'TechCrunch'
            },
            {
                id: 'event-3',
                title: 'AWS re:Invent 2025',
                summary: 'Amazon\'s premier cloud computing conference with technical sessions and product announcements.',
                url: 'https://reinvent.awsevents.com',
                publishDate: new Date().toISOString(),
                category: 'events',
                source: 'AWS Events'
            }
        ];

        sampleData.forEach(item => {
            if (!existingIds.has(item.id)) {
                newsItems.push(item);
            }
        });
    }

    // Fallback data if API fails
    function addFallbackData() {
        const today = new Date();
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);
        const twoDaysAgo = new Date(today);
        twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
        const threeDaysAgo = new Date(today);
        threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
        
        const techNews = [
            {
                id: 'tech-1',
                title: 'React 19 Released with Major Performance Improvements',
                summary: 'The latest version of React brings significant performance enhancements, including automatic batching, new concurrent features, and improved server-side rendering capabilities.',
                url: 'https://react.dev/blog',
                publishDate: today.toISOString(),
                category: 'tech',
                source: 'React Blog'
            },
            {
                id: 'tech-2',
                title: 'TypeScript 5.5 Introduces New Type System Features',
                summary: 'Microsoft releases TypeScript 5.5 with improved type inference, better error messages, and enhanced IDE support for modern JavaScript frameworks.',
                url: 'https://devblogs.microsoft.com/typescript',
                publishDate: yesterday.toISOString(),
                category: 'tech',
                source: 'TypeScript Blog'
            },
            {
                id: 'tech-3',
                title: 'GitHub Copilot Now Supports Voice Commands',
                summary: 'GitHub\'s AI pair programmer gets voice control capabilities, allowing developers to code hands-free and improve accessibility in software development.',
                url: 'https://github.blog',
                publishDate: yesterday.toISOString(),
                category: 'tech',
                source: 'GitHub Blog'
            },
            {
                id: 'tech-4',
                title: 'OpenAI Announces GPT-5 with Enhanced Reasoning',
                summary: 'The next generation of GPT models features improved reasoning capabilities, better context understanding, and reduced hallucinations for more reliable AI applications.',
                url: 'https://openai.com/blog',
                publishDate: twoDaysAgo.toISOString(),
                category: 'tech',
                source: 'OpenAI Blog'
            },
            {
                id: 'tech-5',
                title: 'Rust Surpasses C++ in Developer Satisfaction Survey',
                summary: 'Stack Overflow\'s annual survey shows Rust continues to be the most loved programming language, with growing adoption in systems programming and web development.',
                url: 'https://stackoverflow.blog',
                publishDate: twoDaysAgo.toISOString(),
                category: 'tech',
                source: 'Stack Overflow'
            },
            {
                id: 'tech-6',
                title: 'Next.js 15 Brings Revolutionary App Router Features',
                summary: 'Vercel\'s popular React framework introduces new routing capabilities, improved performance optimization, and better developer experience with built-in caching.',
                url: 'https://nextjs.org/blog',
                publishDate: threeDaysAgo.toISOString(),
                category: 'tech',
                source: 'Next.js Blog'
            },
            {
                id: 'tech-7',
                title: 'Python 3.13 Released with Free-Threading Support',
                summary: 'The latest Python version introduces experimental free-threading capabilities, promising significant performance improvements for multi-threaded applications.',
                url: 'https://www.python.org/downloads',
                publishDate: threeDaysAgo.toISOString(),
                category: 'tech',
                source: 'Python.org'
            },
            {
                id: 'tech-8',
                title: 'Bun 1.0 Challenges Node.js Performance',
                summary: 'The new JavaScript runtime claims 3x faster startup times and built-in TypeScript support, positioning itself as a modern alternative to Node.js.',
                url: 'https://bun.sh/blog',
                publishDate: threeDaysAgo.toISOString(),
                category: 'tech',
                source: 'Bun Blog'
            },
            {
                id: 'tech-9',
                title: 'Docker Announces Native Wasm Support',
                summary: 'Docker Desktop now supports WebAssembly containers natively, enabling faster startup times and better portability for cloud-native applications.',
                url: 'https://www.docker.com/blog',
                publishDate: twoDaysAgo.toISOString(),
                category: 'tech',
                source: 'Docker Blog'
            },
            {
                id: 'tech-10',
                title: 'Tailwind CSS 4.0 Alpha Released',
                summary: 'Major update brings new engine architecture, improved performance, and native CSS cascade layers for better styling control in modern web applications.',
                url: 'https://tailwindcss.com/blog',
                publishDate: yesterday.toISOString(),
                category: 'tech',
                source: 'Tailwind Blog'
            }
        ];

        newsItems.push(...techNews);
    }

    // Show/hide loading spinner
    function showLoading(show) {
        const spinner = document.getElementById('loadingSpinner');
        const grid = document.getElementById('newsGrid');
        
        if (show) {
            spinner.classList.remove('hidden');
            grid.classList.add('hidden');
        } else {
            spinner.classList.add('hidden');
            grid.classList.remove('hidden');
        }
    }

    // Render news items
    function renderNewsItems() {
        const grid = document.getElementById('newsGrid');
        const emptyState = document.getElementById('emptyState');
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const categoryFilter = document.getElementById('categoryFilter').value;

        let filteredItems = newsItems.filter(item => {
            const matchesSearch = item.title.toLowerCase().includes(searchTerm) || 
                                item.summary.toLowerCase().includes(searchTerm);
            const matchesCategory = categoryFilter === 'all' || item.category === categoryFilter;
            return matchesSearch && matchesCategory;
        });

        if (filteredItems.length === 0) {
            grid.classList.add('hidden');
            emptyState.classList.remove('hidden');
            return;
        }

        grid.classList.remove('hidden');
        emptyState.classList.add('hidden');

        grid.innerHTML = filteredItems.map((item, index) => `
            <div class="card-hover rounded-2xl p-6 fade-in" style="animation-delay: ${index * 0.05}s">
                <div class="flex justify-between items-start mb-4">
                    <span class="category-badge px-4 py-2 rounded-full text-xs font-bold ${getCategoryStyle(item.category)}">
                        ${getCategoryIcon(item.category)} ${item.category.toUpperCase()}
                    </span>
                    <span class="text-xs text-gray-500 font-medium">${item.source}</span>
                </div>

                <h3 class="text-xl font-bold mb-3 text-gray-200 line-clamp-2">
                    ${item.title}
                </h3>

                <p class="text-gray-400 text-sm mb-4 line-clamp-3">
                    ${item.summary}
                </p>

                <div class="flex justify-between items-center pt-4 border-t border-gray-700/50">
                    <div class="flex items-center text-sm text-gray-500">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        ${formatDate(item.publishDate)}
                    </div>
                    <a 
                        href="${item.url}" 
                        target="_blank" 
                        rel="noopener noreferrer" 
                        class="flex items-center text-blue-400 hover:text-blue-300 font-semibold text-sm transition-colors"
                    >
                        Read More
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                    </a>
                </div>
            </div>
        `).join('');
    }

    // Get category styling
    function getCategoryStyle(category) {
        const styles = {
            'tech': 'bg-blue-900/50 text-blue-300 border border-blue-700/50',
            'jobs': 'bg-green-900/50 text-green-300 border border-green-700/50',
            'internships': 'bg-purple-900/50 text-purple-300 border border-purple-700/50',
            'events': 'bg-orange-900/50 text-orange-300 border border-orange-700/50'
        };
        return styles[category] || 'bg-gray-900/50 text-gray-300 border border-gray-700/50';
    }

    // Get category icon
    function getCategoryIcon(category) {
        const icons = {
            'tech': 'üì±',
            'jobs': 'üíº',
            'internships': 'üéì',
            'events': 'üé™'
        };
        return icons[category] || 'üì∞';
    }

    // Format date
    function formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays === 0) return 'Today';
        if (diffDays === 1) return 'Yesterday';
        if (diffDays < 7) return `${diffDays} days ago`;
        
        const options = { month: 'short', day: 'numeric', year: 'numeric' };
        return date.toLocaleDateString('en-US', options);
    }

    // Filter items
    function filterItems() {
        renderNewsItems();
    }

    // Select category
    function selectCategory(category) {
        currentCategory = category;
        document.getElementById('categoryFilter').value = category;
        
        // Update tab styles
        document.querySelectorAll('.category-tab').forEach(tab => {
            if (tab.dataset.category === category) {
                tab.classList.add('active');
            } else {
                tab.classList.remove('active');
            }
        });

        filterItems();
    }

    // Update category counts
    function updateCategoryCounts() {
        const counts = {
            all: newsItems.length,
            tech: newsItems.filter(i => i.category === 'tech').length,
            jobs: newsItems.filter(i => i.category === 'jobs').length,
            internships: newsItems.filter(i => i.category === 'internships').length,
            events: newsItems.filter(i => i.category === 'events').length
        };

        Object.keys(counts).forEach(cat => {
            const elem = document.getElementById(`count-${cat}`);
            if (elem) elem.textContent = counts[cat];
        });
    }

    // Update stats
    function updateStats() {
        document.getElementById('stat-tech').textContent = newsItems.filter(i => i.category === 'tech').length;
        document.getElementById('stat-jobs').textContent = newsItems.filter(i => i.category === 'jobs').length;
        document.getElementById('stat-internships').textContent = newsItems.filter(i => i.category === 'internships').length;
        document.getElementById('stat-events').textContent = newsItems.filter(i => i.category === 'events').length;
    }

    // Refresh news
    function refreshNews() {
        fetchNews();
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', init);

    // Keyboard shortcut - Press '/' to focus search
    document.addEventListener('keydown', function(e) {
        if (e.key === '/' && !e.ctrlKey && !e.metaKey && !e.altKey) {
            const searchInput = document.getElementById('searchInput');
            if (document.activeElement !== searchInput) {
                e.preventDefault();
                searchInput.focus();
            }
        }
        if (e.key === 'Escape') {
            document.getElementById('searchInput').value = '';
            filterItems();
        }
    });
</script>
{% endblock %}